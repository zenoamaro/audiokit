{"version":3,"file":"public/app.js","sources":["app/app.coffee","app/components/envelope.coffee","app/components/gain.coffee","app/components/master.coffee","app/components/oscillator.coffee","app/core/class.coffee","app/core/component.coffee","app/core/effect.coffee","app/core/generator.coffee","app/core/music.coffee","app/core/node.coffee","app/generators/mono.coffee","app/input/keyboard.coffee"],"names":[],"mappings":"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","sourcesContent":["Master = require 'components/master'\nMonoOsc = require 'generators/mono'\nKeyboard = require 'input/keyboard'\n\n\n@ctx = new (AudioContext ? webkitAudioContext)\n\n@osc = new MonoOsc ctx,\n\toscillator:\n\t\tshape: 'triangle'\n\t\toctave: -2\n\t\tenvelope:\n\t\t\tattack: .001\n\t\t\tdecay: .1\n\t\t\tsustain: .2\n\t\t\trelease: 2\n\tmodulation:\n\t\tgain: 40\n\t\tfrequency: 6\n\t\tenvelope:\n\t\t\tattack: 2\n\t\t\tdecay: 0\n\t\t\tsustain: 1\n\t\t\trelease: 1\n\n@master = new Master ctx\n@keyboard = new Keyboard\nosc.connect to:master\nkeyboard.connect osc","music = require 'core/music'\nComponent = require 'core/component'\n\nKILL_TIME = .002\nDECAY_SEEK_TIME = .1\n\n\nmodule.exports = class Envelope extends Component\n\n\tdefaults:\n\t\tattack: .01\n\t\tdecay: .01\n\t\tsustain: 1\n\t\trelease: .01\n\n\tinitialize: ->\n\t\t@_connections = []\n\t\t@initializeOutputs()\n\n\treset: (param) ->\n\t\tunless param\n\t\t\tfor param in @_connections\n\t\t\t\t@reset param\n\t\telse\n\t\t\t@cancel param\n\t\t\tparam.linearRampToValueAtTime 0, @ctx.currentTime + KILL_TIME\n\n\tcancel: (param) ->\n\t\tunless param\n\t\t\tfor param in @_connections\n\t\t\t\t@cancel param\n\t\telse\n\t\t\tnow = @ctx.currentTime\n\t\t\tparam.cancelScheduledValues now\n\t\t\tparam.setValueAtTime param.value, now\n\n\ttrigger: (value=on) ->\n\t\tnow = @ctx.currentTime\n\t\tfor param in @_connections\n\t\t\tif value is on\n\t\t\t\tparam.linearRampToValueAtTime 1, now + KILL_TIME + @options.attack\n\t\t\t\tparam.setTargetAtTime @options.sustain, now + KILL_TIME + @options.attack, @options.decay * music.EXP_FALL\n\t\t\telse if value is off\n\t\t\t\t@cancel param\n\t\t\t\tif param.value > @options.sustain\n\t\t\t\t\tdecay_seeker = Math.min(@options.decay, DECAY_SEEK_TIME)\n\t\t\t\telse\n\t\t\t\t\tdecay_seeker = 0\n\t\t\t\tparam.setTargetAtTime @options.sustain, now, decay_seeker * music.EXP_FALL\n\t\t\t\tparam.setTargetAtTime 0, now + decay_seeker, @options.release * music.EXP_FALL\n\n\tinitializeOutputs: ->\n\t\t@outputs.push\n\t\t\tid: 'out'\n\t\t\tnode: => @param\n\n\tconnect: (param) ->\n\t\t@_connections = _.unique @_connections.concat(param)\n\t\t@reset param\n\n\tdisconnect: (param) ->\n\t\t@_connections = _.without @_connections, (p) -> p is param","Component = require 'core/component'\n\n\nmodule.exports = class Gain extends Component\n\n\tdefaults:\n\t\tgain: 1\n\n\tinitialize: (ctx, options) ->\n\t\t@initializeInputs()\n\t\t@initializeOutputs()\n\t\t@_amp = @ctx.createGain()\n\n\tupdate: ->\n\t\t@_amp.gain.value = @options.gain\n\n\tinitializeInputs: ->\n\t\t@inputs.push\n\t\t\tid: 'in'\n\t\t\tnode: => @_amp\n\t\t@inputs.push\n\t\t\tid: 'gain'\n\t\t\tnode: => @_amp.gain\n\n\tinitializeOutputs: ->\n\t\t@outputs.push\n\t\t\tid: 'out'\n\t\t\tnode: => @_amp\n","Gain = require 'components/gain'\n\n\nmodule.exports = class Master extends Gain\n\n\tinitialize: ->\n\t\tsuper\n\t\t@_amp.connect @ctx.destination\n","Component = require 'core/component'\nEnvelope = require 'components/envelope'\n\nKILL_TIME = .002\nMIN_RELEASE_TIME = 2 # FIXME: this should really not be hardcoded\n\n\nmodule.exports = class Oscillator extends Component\n\n\tdefaults:\n\t\tshape: 'sine'\n\t\tgain: 1\n\t\tenvelope:\n\t\t\tattack: .001\n\t\t\tdecay: .1\n\t\t\tsustain: .2\n\t\t\trelease: .001\n\n\tinitialize: ->\n\t\t@initializeInputs()\n\t\t@initializeOutputs()\n\t\t@_out = @ctx.createGain()\n\t\t@_amp = @ctx.createGain()\n\t\t@_mod = @ctx.createGain()\n\t\t@_env = new Envelope @ctx\n\t\t@_amp.gain.value = 0\n\t\t@_env.connect @_amp.gain\n\t\t@_amp.connect @_out\n\n\n\tstartOscillator: ->\n\t\tif @_osc\n\t\t\tclearTimeout @_oscStopTimer\n\t\tunless @_osc\n\t\t\t@_osc = @ctx.createOscillator()\n\t\t\t@_osc.connect @_amp\n\t\t\t@_mod.connect @_osc.detune\n\t\t\t@_osc.start 0\n\t\t@_env.reset()\n\n\tstopOscillator: (release) ->\n\t\tunless @_osc\n\t\t\treturn\n\t\tstop = =>\n\t\t\t@_mod.disconnect @_osc.detune\n\t\t\t@_osc.disconnect @_amp\n\t\t\t@_osc.stop 0\n\t\t\t@_osc = no\n\t\tclearTimeout @_oscStopTimer\n\t\t@_oscStopTimer = setTimeout stop, (Math.max MIN_RELEASE_TIME, release) * 1000\n\n\ttrigger: (state, freq) ->\n\t\tif state is on\n\t\t\t@startOscillator(); @update()\n\t\t\t@_osc.frequency.setValueAtTime freq, @ctx.currentTime + KILL_TIME\n\t\t\t@_env.trigger on\n\t\telse if state is off\n\t\t\t@_env.trigger off\n\t\t\t@stopOscillator @_env.options.release\n\n\tupdate: ->\n\t\t@_osc?.type = @options.shape\n\t\t@_env.set @options.envelope\n\t\t@_out.gain.setValueAtTime @options.gain, @ctx.currentTime\n\n\tinitializeInputs: ->\n\t\t@inputs.push\n\t\t\tid: 'gain'\n\t\t\tnode: => @_amp.gain\n\t\t@inputs.push\n\t\t\tid: 'mod'\n\t\t\tnode: => @_mod\n\n\tinitializeOutputs: ->\n\t\t@outputs.push\n\t\t\tid: 'out'\n\t\t\tnode: => @_out\n","module.exports = class Class\n\n\tdefaults: {}\n\n\tconstructor: (options) ->\n\t\t@initialize?()\n\t\t@set options\n\n\tset: (options) ->\n\t\t@options = $.extend yes, {}, @defaults, @options, options\n","Class = require 'core/class'\n\n\nmodule.exports = class Component extends Class\n\n\tconstructor: (ctx, options) ->\n\t\t@ctx = ctx\n\t\t@inputs = []\n\t\t@outputs = []\n\t\tsuper options\n\n\tinput: (id='in') ->\n\t\t_.find @inputs, (input) -> input.id is id\n\n\toutput: (id='out') ->\n\t\t_.find @outputs, (output) -> output.id is id\n\n\tconnect: (options) ->\n\t\tdest = options.to\n\t\tfromPin = @output options.fromPin\n\t\ttoPin = dest.input options.toPin\n\t\tfromPin.node().connect toPin.node()\n\n\tdisconnect: (options) ->\n\t\tdest = options.to\n\t\tfromPin = @output options.fromPin\n\t\ttoPin = dest.input options.toPin\n\t\tfromPin.node().disconnect toPin.node()\n\n\tset: (options) ->\n\t\tsuper\n\t\t@update()\n\n\tupdate: ->\n","Node = require 'core/node'\nGain = require 'components/gain'\n\n\nmodule.exports = class Effect extends Node\n\n\tdefaults:\n\t\tlevel: 1\n\t\tgain: 1\n\t\twet: 1\n\n\tinitialize: ->\n\t\t@initializeInputs()\n\t\t@initializeOutputs()\n\t\t@_in = new Gain @ctx\n\t\t@_out = new Gain @ctx\n\n\tinitializeInputs: ->\n\t\t@outputs.push\n\t\t\tid:   'in'\n\t\t\tnode: => @_in.input().node()\n\n\tinitializeOutputs: ->\n\t\t@outputs.push\n\t\t\tid:   'out'\n\t\t\tnode: => @_out.output().node()\n\n\tupdate: ->\n\t\t@_in.set  gain:@options.level\n\t\t@_out.set gain:@options.gain\n","Node = require 'core/node'\nGain = require 'components/gain'\n\n\nmodule.exports = class Generator extends Node\n\n\tdefaults:\n\t\tout: {}\n\n\tinitialize: ->\n\t\t@_notes = {}\n\t\t@initializeOutputs()\n\t\t@_out = new Gain @ctx\n\n\tinitializeOutputs: ->\n\t\t@outputs.push\n\t\t\tid:   'out'\n\t\t\tnode: => @_out.output().node()\n\n\tupdate: ->\n\t\t@_out.set @options.out\n\n\ttrigger: (note) ->\n","ROOT     = 261.63\nOCTAVE   = 1200\nK        = OCTAVE / (Math.log 2 / Math.LN10)\nNOTATION = /(\\w#?)(\\d+)/\nNOTES    = 'c':0, 'c#':1, 'd':2, 'd#':3, 'e':4, 'f':5, 'f#':6, 'g':7, 'g#':8, 'a':9, 'a#':10, 'b':11\nEXP_RISE = 63.2 / 100\nEXP_FALL = (100 - 63.2) / 100\n\n# 1 .66 1.6\n\nmodule.exports = music =\n\n\tROOT     : ROOT\n\tOCTAVE   : OCTAVE\n\tEXP_RISE : EXP_RISE\n\tEXP_FALL : EXP_FALL\n\n\tnote: (note) ->\n\t\tif match = NOTATION.exec note\n\t\t\t[match, note, octave] = match\n\t\t\toctave = (parseInt octave, 10) - 4\n\t\t\tnote = NOTES[note.toLowerCase()]\n\t\t\treturn (100 * note) + music.octaves octave\n\t\telse\n\t\t\tno\n\n\thz: (cents) ->\n\t\tROOT * Math.pow (Math.pow 2, 1/OCTAVE), cents\n\n\toctaves: (oct) ->\n\t\tOCTAVE * oct\n","Component = require 'core/component'\n\n\nmodule.exports = class Node extends Component\n\n","music = require 'core/music'\nGain = require 'components/gain'\nOscillator = require 'components/oscillator'\nEnvelope = require 'components/envelope'\nGenerator = require 'core/generator'\n\n\nmodule.exports = class MonoOsc extends Generator\n\n\tdefaults:\n\t\tout: {}\n\t\tmodulation:\n\t\t\tshape: 'triangle'\n\t\t\tgain: 0\n\t\t\tfrequency: 10\n\t\toscillator:\n\t\t\tshape: 'triangle'\n\t\t\toctave: 0\n\t\t\ttune: 0\n\n\tinitialize: ->\n\t\tsuper\n\n\tupdate: ->\n\t\tsuper\n\t\tfor note, nodes of @_notes\n\t\t\tnodes.osc.set @options.oscillator\n\t\t\tnodes.mod.set @options.modulation\n\n\tfrequency: (note) ->\n\t\tcents = (music.note note) \\\n\t\t      + (music.octaves @options.oscillator.octave) \\\n\t\t      + (@options.oscillator.tune)\n\t\treturn music.hz cents\n\n\tnoteOn: (note) ->\n\t\tunless note of @_notes\n\t\t\t@_notes[note] =\n\t\t\t\tosc: osc = new Oscillator @ctx\n\t\t\t\tmod: mod = new Oscillator @ctx\n\t\t\t@update()\n\t\t\tmod.trigger on, @options.modulation.frequency\n\t\t\tosc.trigger on, @frequency note\n\t\t\tmod.connect to:osc, toPin:'mod'\n\t\t\tosc.connect to:@_out\n\n\tnoteOff: (note) ->\n\t\tif block = @_notes[note]\n\t\t\t{osc, mod} = block\n\t\t\tosc.trigger off\n\t\t\tmod.trigger off\n\t\t\tdelete @_notes[note]\n\n\ttrigger: (note, state) ->\n\t\tif state is on\n\t\t\t@noteOn note\n\t\telse if state is off\n\t\t\t@noteOff note\n\n","Class = require 'core/class'\n\n\n# FIXME: This is probably only valid for an italian keymap.\n#        Problem is, there's no way to accurately distinguish\n#        some keycodes from others in certain keymaps.\n\nNOTE_MAP =\n\t# Lower\n\t'U+003C': 'b4'\n\t'U+005A': 'c5'\n\t'U+0053': 'c#5'\n\t'U+0058': 'd5'\n\t'U+0044': 'd#5'\n\t'U+0043': 'e5'\n\t'U+0056': 'f5'\n\t'U+0047': 'f#5'\n\t'U+0042': 'g5'\n\t'U+0048': 'g#5'\n\t'U+004E': 'a5'\n\t'U+004A': 'a#5'\n\t'U+004D': 'b5'\n\t'U+002C': 'c6'\n\t'U+004C': 'c#6'\n\t'U+002E': 'd6'\n\t'U+00F2': 'd#6'\n\t'U+002D': 'e6'\n\t# Upper\n\t'U+0051': 'c6'\n\t'U+0032': 'c#6'\n\t'U+0057': 'd6'\n\t'U+0033': 'd#6'\n\t'U+0045': 'e6'\n\t'U+0052': 'f6'\n\t'U+0035': 'f#6'\n\t'U+0054': 'g6'\n\t'U+0036': 'g#6'\n\t'U+0059': 'a6'\n\t'U+0037': 'a#6'\n\t'U+0055': 'b6'\n\t'U+0049': 'c7'\n\t'U+0039': 'c#7'\n\t'U+004F': 'd7'\n\t'U+0030': 'd#7'\n\t'U+0050': 'e7'\n\t'U+00E8': 'f7'\n\t'U+00EC': 'f#7'\n\t'U+002B': 'g7'\n\nmodule.exports = class Keyboard extends Class\n\n\tdefaults: {}\n\n\tinitialize: ->\n\t\t@_connections = []\n\t\tdocument.body.addEventListener 'keydown', @onKeyDown\n\t\tdocument.body.addEventListener 'keyup', @onKeyUp\n\n\tconnect: (node) ->\n\t\t@_connections = _.unique @_connections.concat(node)\n\n\tdisconnect: (node) ->\n\t\t@_connections = _.without @_connections, (p) -> p is node\n\n\tnoteFromKeycode: (keycode) ->\n\t\tNOTE_MAP[keycode]\n\n\ttrigger: (note, state) ->\n\t\tfor conn in @_connections\n\t\t\tconn.trigger note, state\n\n\tonKeyDown: (event) =>\n\t\tnote = @noteFromKeycode event.keyIdentifier\n\t\tif note then @trigger note, on\n\t\treturn false\n\n\tonKeyUp: (event) =>\n\t\tnote = @noteFromKeycode event.keyIdentifier\n\t\tif note then @trigger note, off\n\t\treturn false\n"]}